<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Brick Breaker Game</title>
  <style>
    body { 
      font-family: Arial, sans-serif; 
      background: #111; 
      color: #fff; 
      text-align: center; 
    }
    canvas { 
      background: #000; 
      display: block; 
      margin: 20px auto; 
      border: 2px solid white; 
    }
    #controls, #touchControls { margin: 15px; }
    button { 
      margin: 5px; padding: 10px 20px; 
      background: #444; color: #fff; border: none; 
      border-radius: 6px; cursor: pointer;
    }
    button:hover { background: #666; }
    #leaderboard { 
      margin-top: 20px; 
      background: #222; 
      padding: 15px; 
      border-radius: 10px; 
      display: none; 
    }
    input { padding: 8px; margin: 10px; }
    #touchControls { display: flex; justify-content: center; align-items: center; gap: 20px; margin-top: 10px; }
    #joystick { width: 80px; height: 80px; border: 2px solid #fff; border-radius: 50%; touch-action: none; position: relative; margin: 0 auto; }
    #stick { width: 40px; height: 40px; background: #fff; border-radius: 50%; position: absolute; top: 20px; left: 20px; }
  </style>
</head>
<body>
  <h1>üî• Brick Breaker Game üî•</h1>

  <!-- Login -->
  <div id="login">
    <p>Enter your name to start:</p>
    <input type="text" id="username" placeholder="Your name">
    <button onclick="startGame()">Start Game</button>
  </div>

  <!-- Canvas -->
  <canvas id="gameCanvas" width="400" height="400" style="display:none;"></canvas>

  <!-- Controls -->
  <div id="controls" style="display:none;">
    <button onclick="pauseGame()">‚è∏ Pause</button>
    <button onclick="resumeGame()">‚ñ∂ Resume</button>
    <button onclick="resetGame()">üîÑ Retry</button>
    <button id="soundBtn" onclick="toggleSound()">üîä Sound</button>
  </div>

  <!-- Joystick -->
  <div id="touchControls" style="display:none;">
    <div id="joystick">
      <div id="stick"></div>
    </div>
  </div>

  <!-- Leaderboard -->
  <div id="leaderboard">
    <h2>üèÜ Leaderboard</h2>
    <ol id="scoresList"></ol>
    <button onclick="playAgain()">Play Again</button>
  </div>

<script>
const canvas = document.getElementById("gameCanvas");
const ctx = canvas.getContext("2d");

let paddle, ball, bricks, score, gameInterval, isPaused, currentUser, level, ballSpeed, lives;
let soundOn = true;

function startGame() {
  const usernameInput = document.getElementById("username").value.trim();
  if (!usernameInput) { alert("Please enter your name!"); return; }
  currentUser = usernameInput;
  document.getElementById("login").style.display = "none";
  canvas.style.display = "block";
  document.getElementById("controls").style.display = "block";
  document.getElementById("touchControls").style.display = "block";
  resetGame();
}

function resetGame() {
  paddle = { x: canvas.width/2 - 50, y: canvas.height-20, width: 100, height: 10, dx: 0 };
  ball = { x: canvas.width/2, y: canvas.height-30, radius: 8, dx: 3, dy: -3 };
  level = 1; score = 0; ballSpeed = 3; isPaused = false; lives = 3;
  createBricks(level);
  clearInterval(gameInterval);
  gameInterval = setInterval(drawGame, 16);
}

function createBricks(level) {
  bricks = [];
  const rows = level + 2;
  const cols = 7;
  const brickWidth = 45; // FIX: chhoti bricks
  for (let r=0; r<rows; r++){
    bricks[r]=[];
    for (let c=0; c<cols; c++){
      bricks[r][c]={ x:0, y:0, status:1 };
    }
  }
}

function drawGame() {
  if(isPaused) return;
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // Paddle
  ctx.fillStyle="lime";
  ctx.fillRect(paddle.x,paddle.y,paddle.width,paddle.height);

  // Ball
  ctx.beginPath();
  ctx.arc(ball.x,ball.y,ball.radius,0,Math.PI*2);
  ctx.fillStyle="red"; ctx.fill(); ctx.closePath();

  // Bricks
  const brickWidth=45, brickHeight=20, padding=10, offsetTop=30, offsetLeft=10; // FIX
  for(let r=0;r<bricks.length;r++){
    for(let c=0;c<bricks[r].length;c++){
      if(bricks[r][c].status){
        let brickX = c*(brickWidth+padding)+offsetLeft;
        let brickY = r*(brickHeight+padding)+offsetTop;
        bricks[r][c].x = brickX; bricks[r][c].y = brickY;
        ctx.fillStyle="orange";
        ctx.fillRect(brickX,brickY,brickWidth,brickHeight);
      }
    }
  }

  // Ball movement
  ball.x += ball.dx; ball.y += ball.dy;

  if(ball.x+ball.radius>canvas.width || ball.x-ball.radius<0) ball.dx*=-1;
  if(ball.y-ball.radius<0) ball.dy*=-1;

  if(ball.y+ball.radius>paddle.y && ball.x>paddle.x && ball.x<paddle.x+paddle.width){
    ball.dy*=-1;
    let hitPoint = ball.x-(paddle.x+paddle.width/2);
    ball.dx = hitPoint*0.15;
  }

  // Collision with bricks
  for(let r=0;r<bricks.length;r++){
    for(let c=0;c<bricks[r].length;c++){
      const b = bricks[r][c];
      if(b.status && ball.x>b.x && ball.x<b.x+brickWidth && ball.y-ball.radius<b.y+brickHeight && ball.y+ball.radius>b.y){
        ball.dy*=-1; b.status=0; score++;
      }
    }
  }

  // Paddle movement
  paddle.x += paddle.dx;
  if(paddle.x<0) paddle.x=0;
  if(paddle.x+paddle.width>canvas.width) paddle.x=canvas.width-paddle.width;

  // Ball out of bounds
  if(ball.y-ball.radius>canvas.height){ 
    lives--;
    if(lives>0){
      ball.x = canvas.width/2;
      ball.y = canvas.height-30;
      ball.dx = 3; ball.dy = -3;
    } else {
      endGame(); 
      return; 
    }
  }

  // Next level
  if(bricks.flat().every(b=>b.status===0)){
    if(level < 50){
      level++; ballSpeed += 0.5;
      ball.dx = ballSpeed; ball.dy = -ballSpeed;
      createBricks(level);
      ball.x = canvas.width/2; ball.y = canvas.height-30;
    } else {
      alert("üéâ Congratulations! Level 50 completed!");
      endGame();
    }
  }

  // Score + Level + Lives text
  ctx.fillStyle="white";
  ctx.font="18px Arial";
  ctx.fillText("Score: "+score,10,20);
  ctx.fillText("Level: "+level,300,20);
  ctx.fillText("Lives: "+lives,160,20);
}

// Keyboard
document.addEventListener("keydown", e=>{
  if(e.key==="ArrowLeft") paddle.dx=-6;
  if(e.key==="ArrowRight") paddle.dx=6;
});
document.addEventListener("keyup", e=>{
  if(e.key==="ArrowLeft"||e.key==="ArrowRight") paddle.dx=0;
});

// Pause/Resume/Sound
function pauseGame(){ isPaused=true; }
function resumeGame(){ isPaused=false; }
function toggleSound(){ soundOn=!soundOn; document.getElementById("soundBtn").textContent = soundOn?"üîä Sound":"üîá Mute"; }

// End game
function endGame(){ clearInterval(gameInterval); saveScore(currentUser,score); showLeaderboard(); }

// Leaderboard
function saveScore(user, score){
  let scores=JSON.parse(localStorage.getItem("brickScores"))||[];
  let existing = scores.find(s=>s.user===user);
  if(existing){ if(score>existing.score) existing.score=score; } 
  else { scores.push({user, score}); }
  scores.sort((a,b)=>b.score-a.score);
  localStorage.setItem("brickScores", JSON.stringify(scores));
}

function showLeaderboard(){
  document.getElementById("controls").style.display="none";
  document.getElementById("touchControls").style.display="none";
  canvas.style.display="none";
  const scores=JSON.parse(localStorage.getItem("brickScores"))||[];
  const scoresList=document.getElementById("scoresList"); scoresList.innerHTML="";
  scores.forEach((s,index)=>{
    const li=document.createElement("li"); li.textContent=`${s.user} - ${s.score}`;
    scoresList.appendChild(li);
  });
  document.getElementById("leaderboard").style.display="block";
}

function playAgain(){
  document.getElementById("leaderboard").style.display="none";
  canvas.style.display="block";
  document.getElementById("controls").style.display="block";
  document.getElementById("touchControls").style.display="block";
  resetGame();
}

// Joystick logic
const joystick = document.getElementById("joystick");
const stick = document.getElementById("stick");
let dragging = false, startX;

stick.addEventListener("pointerdown", e=>{
  dragging=true; startX=e.clientX;
});

document.addEventListener("pointermove", e=>{
  if(!dragging) return;
  let dx = e.clientX - startX;
  let max = 30;
  dx = Math.max(-max, Math.min(max, dx));
  stick.style.left = 20 + dx + 'px';
  paddle.dx = dx * 0.2;
});

document.addEventListener("pointerup", ()=>{
  dragging=false;
  stick.style.left='20px';
  paddle.dx=0;
});
</script>
</body>
</html>
