<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rudi-like Web Voice Assistant</title>
<style>
  :root{
    --bg:#0f1720; --card:#0b1220; --muted:#94a3b8; --accent:#22c55e; --accent2:#60a5fa;
    --glass: rgba(255,255,255,0.03);
  }
  html,body{height:100%; margin:0; font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; background:linear-gradient(180deg,#07111a 0%, #08131a 100%); color:#e6eef8}
  .wrap{max-width:980px; margin:28px auto; padding:20px;}
  header{display:flex;align-items:center;gap:16px}
  h1{font-size:20px;margin:0}
  .subtitle{color:var(--muted); font-size:13px}
  .controls{display:flex;gap:8px; margin-top:14px; flex-wrap:wrap}
  button{background:var(--card); color:inherit;border:1px solid rgba(255,255,255,0.03); padding:10px 12px; border-radius:8px; cursor:pointer}
  button.primary{background:linear-gradient(90deg,var(--accent),var(--accent2)); color:#022; font-weight:700}
  .panel{margin-top:18px; display:grid; grid-template-columns: 1fr 360px; gap:16px}
  .card{background:var(--glass); border-radius:10px; padding:14px; box-shadow:0 6px 24px rgba(2,6,23,0.6); border:1px solid rgba(255,255,255,0.03)}
  #left {min-height:420px}
  #right {min-height:420px}
  #transcript{min-height:120px; background: rgba(255,255,255,0.02); padding:10px; border-radius:8px; color:#dff0d8}
  #log{height:260px; overflow:auto; font-size:13px; color:var(--muted); background: rgba(255,255,255,0.01); padding:8px; border-radius:6px}
  .row{display:flex; gap:8px; align-items:center}
  label{font-size:13px;color:var(--muted)}
  input[type="text"]{flex:1; padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03); background:transparent; color:inherit}
  .hint{font-size:12px;color:var(--muted); margin-top:8px}
  .smallbtn{padding:6px 8px; font-size:13px}
  .status{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.03); color:var(--muted); font-size:13px}
  .command-list{display:grid;grid-template-columns:repeat(2,1fr);gap:6px;margin-top:10px}
  .cmd{background:rgba(255,255,255,0.02); padding:8px;border-radius:6px;font-size:13px;color:var(--muted)}
  footer{margin-top:18px;text-align:center;color:var(--muted);font-size:13px}
  .kbd{background:#071827;padding:4px 8px;border-radius:6px;border:1px solid rgba(255,255,255,0.04); font-weight:700}
  .muted{color:var(--muted)}
  @media (max-width:900px){ .panel{grid-template-columns:1fr} #right{order:2} }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Rudi — Web Voice Assistant</h1>
        <div class="subtitle">Speak commands or type them. Works in Chrome/Edge. No server required.</div>
      </div>
      <div style="margin-left:auto;text-align:right">
        <div class="status" id="listenStatus">Idle</div>
        <div style="height:6px"></div>
        <div class="muted" style="font-size:12px">Language: <span id="langLabel">English (en-US)</span></div>
      </div>
    </header>

    <div class="controls">
      <button id="btnStart" class="primary">Start Listening</button>
      <button id="btnStop">Stop</button>
      <button id="btnWake">Wake-word: <span id="wakeState">Off</span></button>
      <button id="btnToggleVoice">Toggle Voice Reply</button>
      <button id="btnClearLog" class="smallbtn">Clear Log</button>
      <select id="langSelect" style="padding:8px;border-radius:8px;background:var(--card);color:inherit">
        <option value="en-US">English (en-US)</option>
        <option value="hi-IN">Hindi (hi-IN)</option>
      </select>
    </div>

    <div class="panel">
      <div id="left" class="card">
        <h3>Say or type a command</h3>
        <div id="transcript">Press <span class="kbd">Start Listening</span> and speak — or type below.</div>

        <div style="margin-top:12px" class="row">
          <input id="cmdInput" type="text" placeholder="e.g. open youtube / what is the time / search cats" />
          <button id="btnSend" class="smallbtn">Send</button>
        </div>

        <div class="hint">Tip: Say <b>"Hey Rudi"</b> to activate when wake-word is ON. Try: <em>open youtube, search weather Chennai, time, wiki Tesla, calculate 12*8, set timer 10 seconds</em></div>

        <div style="margin-top:12px">
          <strong>Quick commands</strong>
          <div class="command-list">
            <div class="cmd">open youtube</div>
            <div class="cmd">open google</div>
            <div class="cmd">search cats</div>
            <div class="cmd">time</div>
            <div class="cmd">date</div>
            <div class="cmd">wiki tesla</div>
            <div class="cmd">calculate 12 + 34</div>
            <div class="cmd">set timer 15 seconds</div>
            <div class="cmd">play music</div>
            <div class="cmd">tell me a joke</div>
          </div>
        </div>
      </div>

      <div id="right" class="card">
        <h3>Activity Log</h3>
        <div id="log"></div>

        <h4 style="margin-top:12px">Settings</h4>
        <div class="row" style="margin-top:6px">
          <label>Voice reply:</label>
          <input type="checkbox" id="chkVoice" checked />
        </div>
        <div class="row" style="margin-top:6px">
          <label>Continuous listen:</label>
          <input type="checkbox" id="chkContinuous" />
        </div>
        <div style="margin-top:10px" class="muted">Supported in Chrome/Edge. Safari support is limited.</div>
      </div>
    </div>

    <footer>
      Built for you — say hi and try commands. DEVELOPED BY RUDRANSH PANDEY (A GENIUS).  
    </footer>
  </div>

<script>
(function(){
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  const synth = window.speechSynthesis;

  const btnStart = document.getElementById('btnStart');
  const btnStop = document.getElementById('btnStop');
  const btnWake = document.getElementById('btnWake');
  const btnToggleVoice = document.getElementById('btnToggleVoice');
  const btnClearLog = document.getElementById('btnClearLog');
  const langSelect = document.getElementById('langSelect');
  const langLabel = document.getElementById('langLabel');
  const listenStatus = document.getElementById('listenStatus');
  const transcriptEl = document.getElementById('transcript');
  const cmdInput = document.getElementById('cmdInput');
  const btnSend = document.getElementById('btnSend');
  const logEl = document.getElementById('log');
  const chkVoice = document.getElementById('chkVoice');
  const chkContinuous = document.getElementById('chkContinuous');
  const wakeStateSpan = document.getElementById('wakeState');

  let recognition = null;
  let listening = false;
  let wakeWordOn = false;
  let lastTranscript = '';
  let lang = 'en-US';
  let continuous = false;

  const jokes = [
    "Why did the developer go broke? Because he used up all his cache.",
    "Why do programmers prefer dark mode? Because the light attracts bugs.",
    "I told my computer I needed a break, and it said — 'No problem, I'll go to sleep.'"
  ];

  function log(message, type='info'){
    const time = new Date().toLocaleTimeString();
    const el = document.createElement('div');
    el.innerHTML = `<strong style="color:#9ae6b4">${time}</strong> — <span style="color:${type==='err'?'#ff7b7b':'#cfe8ff'}">${escapeHtml(message)}</span>`;
    logEl.prepend(el);
  }

  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

  function speak(text, opts = {}){
    if(!chkVoice.checked) return;
    if(!synth) return;
    try {
      const u = new SpeechSynthesisUtterance(text);
      u.lang = opts.lang || lang;
      u.rate = opts.rate || 1.0;
      u.pitch = opts.pitch || 1.0;
      synth.cancel();
      synth.speak(u);
    } catch (e) {
      console.error('synth error', e);
    }
  }

  function setupRecognition(){
    if(!SpeechRecognition) {
      listenStatus.textContent = 'SpeechRecognition not supported';
      btnStart.disabled = true; btnStop.disabled = true;
      return;
    }
    recognition = new SpeechRecognition();
    recognition.lang = lang;
    recognition.interimResults = false;
    recognition.continuous = continuous;

    recognition.onstart = () => {
      listening = true;
      listenStatus.textContent = 'Listening...';
      btnStart.textContent = 'Listening';
      log('Voice recognition started');
    };

    recognition.onend = () => {
      listening = false;
      listenStatus.textContent = 'Idle';
      btnStart.textContent = 'Start Listening';
      log('Voice recognition stopped');
      if(chkContinuous.checked && recognition){
        setTimeout(()=> { try{ recognition.start() } catch(e){} }, 250);
      }
    };

    recognition.onerror = (ev) => {
      log('Speech error: ' + ev.error, 'err');
    };

    recognition.onresult = (ev) => {
      const res = ev.results[ev.results.length - 1][0].transcript.trim();
      lastTranscript = res;
      transcriptEl.textContent = 'Heard: "' + res + '"';
      log('Heard: ' + res);
      if(wakeWordOn){
        if(res.toLowerCase().includes('hey rudi') || res.toLowerCase().includes('ok rudi')){
          speak('Yes, I am listening');
          log('Wake word detected — ready for command');
          return;
        }
        if(res.toLowerCase().startsWith('hey rudi')) {
          const cmd = res.toLowerCase().replace(/^hey rudi[, ]*/,'').trim();
          if(cmd) handleCommand(cmd);
          return;
        } else {
          log('Ignored (wake-word on)', 'info');
          return;
        }
      } else {
        handleCommand(res);
      }
    };
  }

  async function handleCommand(textRaw){
    const text = textRaw.trim();
    if(!text) return;
    addTranscriptEntry('User: ' + text);
    const lower = text.toLowerCase();

    if(/^(hi|hello|hey|hey rudi)\b/.test(lower)){
      speak('Hello ' + (currentUserName() || '') + '. How can I help?');
      addTranscriptEntry('Rudi: greeting');
      return;
    }

    if(lower.includes('time')) {
      const now = new Date();
      const out = `It is ${now.toLocaleTimeString()}`;
      speak(out);
      addTranscriptEntry('Rudi: ' + out);
      return;
    }
    if(lower.includes('date')) {
      const now = new Date();
      const out = `Today is ${now.toLocaleDateString()}`;
      speak(out);
      addTranscriptEntry('Rudi: ' + out);
      return;
    }

    if(lower.match(/\bopen (youtube|google|wikipedia|github)\b/)) {
      let site = 'https://google.com';
      if(lower.includes('youtube')) site = 'https://youtube.com';
      else if(lower.includes('wikipedia')) site = 'https://wikipedia.org';
      else if(lower.includes('github')) site = 'https://github.com';
      speak('Opening ' + site.replace(/^https?:\/\//,''));
      window.open(site, '_blank');
      addTranscriptEntry('Rudi: opening ' + site);
      return;
    }

    if(lower.startsWith('search ') || lower.startsWith('google ')) {
      const q = text.replace(/^(search|google)\s+/i,'').trim();
      if(!q){ speak('What do you want me to search?'); return; }
      speak('Searching Google for ' + q);
      const url = 'https://www.google.com/search?q=' + encodeURIComponent(q);
      window.open(url, '_blank');
      addTranscriptEntry('Rudi: searched for ' + q);
      return;
    }

    if(lower.startsWith('wiki ') || lower.startsWith('wikipedia ')) {
      const term = text.replace(/^(wiki|wikipedia)\s+/i,'').trim();
      if(!term){ speak('What do you want from Wikipedia?'); return; }
      speak('Searching Wikipedia for ' + term);
      addTranscriptEntry('Rudi: fetching wikipedia for ' + term);
      try {
        const api = 'https://en.wikipedia.org/api/rest_v1/page/summary/' + encodeURIComponent(term);
        const r = await fetch(api);
        if(!r.ok) { speak('No Wikipedia page found for ' + term); return; }
        const j = await r.json();
        const extract = j.extract ? j.extract.split('. ').slice(0,2).join('. ') + '.' : 'No summary available.';
        speak(extract);
        addTranscriptEntry('Wiki: ' + extract);
      } catch (e) {
        speak('Failed to fetch Wikipedia.');
        addTranscriptEntry('Wiki error: ' + e.message, 'err');
      }
      return;
    }

    if(lower.startsWith('calculate ') || lower.startsWith('what is ') || /^[0-9\+\-\*\/\. ]+$/.test(lower)) {
      const expr = text.replace(/^(calculate|what is)\s+/i,'').replace(/[^0-9+\-*/(). %]/g,'');
      if(!expr){ speak('I could not parse the expression'); return; }
      try {
        const val = Function('"use strict";return (' + expr + ')')();
        speak('The result is ' + val);
        addTranscriptEntry('Calc: ' + expr + ' = ' + val);
      } catch (e) {
        speak('Sorry, cannot calculate that.');
        addTranscriptEntry('Calc error: ' + e.message, 'err');
      }
      return;
    }

    if(lower.startsWith('set timer') || lower.startsWith('timer ')) {
      const m = lower.match(/(\d+)\s*(seconds|second|minutes|minute|secs|mins)?/);
      if(!m){ speak('Please tell me the time in seconds or minutes'); return; }
      let num = parseInt(m[1],10);
      let unit = (m[2]||'seconds').toLowerCase();
      let ms = (unit.startsWith('min')) ? num * 60 * 1000 : num * 1000;
      speak('Timer set for ' + num + ' ' + (unit.startsWith('min') ? 'minutes' : 'seconds'));
      addTranscriptEntry('Timer: ' + num + ' ' + unit);
      setTimeout(()=>{
        speak('Timer finished: ' + num + ' ' + (unit.startsWith('min') ? 'minutes' : 'seconds'));
        alert('Timer finished: ' + num + ' ' + unit);
      }, ms);
      return;
    }

    if(lower.includes('play music') || lower.includes('play song') || lower.includes('play some music')) {
      speak('Playing music');
      window.open('https://youtu.be/sUf2PtEZris?feature=shared', '_blank');
      return;
    }

    if(lower.includes('joke')) {
      const j = jokes[Math.floor(Math.random()*jokes.length)];
      speak(j);
      addTranscriptEntry('Joke: ' + j);
      return;
    }

    const openMatch = lower.match(/^open (https?:\/\/\S+|\S+\.\S{2,})$/);
    if(openMatch) {
      const target = openMatch[1].startsWith('http') ? openMatch[1] : 'https://' + openMatch[1];
      speak('Opening ' + target);
      window.open(target, '_blank');
      return;
    }

    if(lower.includes('stop listening') || lower.includes('stop') || lower.includes('quit')) {
      speak('Okay, I will stop listening now.');
      if(recognition && listening){
        try { recognition.stop(); } catch(e){}
      }
      return;
    }

    // ✅ Extra: Physics Wallah app / site
    if(lower.includes("open pw") || lower.includes("physics wallah") || lower.includes("play pw")){
      speak("Opening Physics Wallah for you");
      // Try opening app via intent
      window.location.href = "intent://#Intent;package=in.eduwall.pwclassroom;scheme=pw;end";
      // Fallback → website
      setTimeout(() => {
        window.open("https://www.pw.live/", "_blank");
      }, 1000);
      return;
    }

    // Fallback if nothing matched
    speak("Sorry, I did not understand that command.");
    addTranscriptEntry("Rudi: command not recognized");
  }

  function addTranscriptEntry(msg){
    const el = document.createElement('div');
    el.textContent = msg;
    transcriptEl.appendChild(el);
    transcriptEl.scrollTop = transcriptEl.scrollHeight;
  }

  function currentUserName(){
    return "Rudransh";
  }

  // UI bindings
  btnStart.onclick = ()=>{
    if(!recognition) setupRecognition();
    if(recognition && !listening){
      recognition.start();
    }
  };
  btnStop.onclick = ()=>{
    if(recognition && listening){ recognition.stop(); }
  };
  btnWake.onclick = ()=>{
    wakeWordOn = !wakeWordOn;
    wakeStateSpan.textContent = wakeWordOn ? "On" : "Off";
    speak('Wake word ' + (wakeWordOn ? 'enabled' : 'disabled'));
  };
  btnToggleVoice.onclick = ()=> {
    chkVoice.checked = !chkVoice.checked;
    speak('Voice reply ' + (chkVoice.checked ? 'enabled' : 'disabled'));
  };
  btnClearLog.onclick = ()=>{ logEl.innerHTML=''; };
  btnSend.onclick = ()=>{
    const txt = cmdInput.value.trim();
    if(txt){ handleCommand(txt); cmdInput.value=''; }
  };
  langSelect.onchange = ()=>{
    lang = langSelect.value;
    langLabel.textContent = langSelect.options[langSelect.selectedIndex].text;
    if(recognition){ try{ recognition.stop(); } catch(e){} setupRecognition(); }
  };
  chkContinuous.onchange = ()=>{
    continuous = chkContinuous.checked;
    if(recognition){ try{ recognition.stop(); } catch(e){} setupRecognition(); }
  };

  // Init
  setupRecognition();

})();
</script>
</body>
</html>
